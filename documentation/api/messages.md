# Messages API

Endpoints for managing messages within chat sessions.

## Endpoints

### Get Messages for Chat Session

```
GET /api/v1/chat-sessions/{chat_session_id}/messages
```

Retrieves messages for a specific chat session, with pagination.

**Path Parameters:**
- `chat_session_id`: ID of the chat session

**Query Parameters:**
- `page` (optional): Page number (default: 1)
- `per_page` (optional): Items per page (default: 50, max: 100)
- `before` (optional): Timestamp to get messages before (ISO format)
- `after` (optional): Timestamp to get messages after (ISO format)

**Response:**
```json
{
  "items": [
    {
      "id": 1,
      "chat_session_id": 1,
      "role": "user",
      "content": "Hello, Mr. Holmes. I have a case for you.",
      "timestamp": "2023-01-15T12:30:00Z"
    },
    {
      "id": 2,
      "chat_session_id": 1,
      "role": "assistant",
      "content": "Indeed? Pray tell me the details, and omit nothing, no matter how trivial it may seem. The smallest trifles are often the most significant.",
      "timestamp": "2023-01-15T12:31:00Z"
    },
    // More messages...
  ],
  "pagination": {
    "page": 1,
    "per_page": 50,
    "total_items": 6,
    "total_pages": 1
  }
}
```

### Get Message by ID

```
GET /api/v1/messages/{message_id}
```

Retrieves a specific message by ID.

**Path Parameters:**
- `message_id`: ID of the message to retrieve

**Response:**
```json
{
  "id": 1,
  "chat_session_id": 1,
  "role": "user",
  "content": "Hello, Mr. Holmes. I have a case for you.",
  "timestamp": "2023-01-15T12:30:00Z"
}
```

### Create Message

```
POST /api/v1/chat-sessions/{chat_session_id}/messages
```

Creates a new message in a chat session. This endpoint also triggers the generation of an AI response if the created message is from the user.

**Path Parameters:**
- `chat_session_id`: ID of the chat session

**Request Body:**
```json
{
  "role": "user",
  "content": "My valuable pocket watch has disappeared from my locked study."
}
```

**Response:**
```json
{
  "user_message": {
    "id": 7,
    "chat_session_id": 1,
    "role": "user",
    "content": "My valuable pocket watch has disappeared from my locked study.",
    "timestamp": "2023-01-16T15:20:00Z"
  },
  "ai_message": {
    "id": 8,
    "chat_session_id": 1,
    "role": "assistant",
    "content": "Interesting. Was there any sign of forced entry? And do tell me, who has had access to your study in the past 24 hours? The timing of the disappearance may be most illuminating.",
    "timestamp": "2023-01-16T15:20:10Z"
  }
}
```

### Update Message

```
PUT /api/v1/messages/{message_id}
```

Updates an existing message. This is typically only allowed for user messages, not AI messages.

**Path Parameters:**
- `message_id`: ID of the message to update

**Request Body:**
```json
{
  "content": "My valuable gold pocket watch has disappeared from my locked study cabinet."
}
```

**Response:**
```json
{
  "id": 7,
  "chat_session_id": 1,
  "role": "user",
  "content": "My valuable gold pocket watch has disappeared from my locked study cabinet.",
  "timestamp": "2023-01-16T15:20:00Z",
  "updated_at": "2023-01-16T15:25:00Z"
}
```

### Delete Message

```
DELETE /api/v1/messages/{message_id}
```

Deletes a message.

**Path Parameters:**
- `message_id`: ID of the message to delete

**Response:**
```json
{
  "message": "Message deleted successfully"
}
```

### Regenerate AI Response

```
POST /api/v1/chat-sessions/{chat_session_id}/regenerate
```

Regenerates the most recent AI response in the chat session.

**Path Parameters:**
- `chat_session_id`: ID of the chat session

**Response:**
```json
{
  "id": 10,
  "chat_session_id": 1,
  "role": "assistant",
  "content": "A new response generated by the AI model, replacing the previous one.",
  "timestamp": "2023-01-16T15:45:00Z"
}
```
